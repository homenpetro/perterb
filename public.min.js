/*! WP Simple Pay Lite for Stripe - 2.2.0
 * https://wpsimplepay.com/
 * Copyright (c) Sandhills Development, LLC 2019
 * Licensed GPLv2+ */

var simpayApp={};!function(s){"use strict";var a;simpayApp={formCount:0,spFormElList:{},spFormData:{},init:function(){a=s(document.body),simpayApp.spFormElList=a.find(".simpay-checkout-form"),simpayApp.spFormElList.each(function(){var i=s(this);simpayApp.setupCoreForm(i),simpayApp.formCount++,a.trigger("simpaySetupCoreForm",[i])})},isStripeCheckoutForm:function(i){return void 0===i.formDisplayType||"stripe_checkout"===i.formDisplayType},setupCoreForm:function(i){i.attr("data-simpay-form-instance",simpayApp.formCount);var e=i.data("simpay-form-id"),n=simplePayForms[e],t=s.extend({},n.form.bools,n.form.integers,n.form.i18n,n.form.strings);t.formInstance=simpayApp.formCount,t.formId=e,t.finalAmount=t.amount,t.quantity=1,t.stripeParams=s.extend({},n.stripe.strings,n.stripe.bools),t.oldPanelLabel=void 0!==t.stripeParams.panelLabel?t.stripeParams.panelLabel:"",t.submitBtnClass="simpay-payment-btn",a.trigger("simpayCoreFormVarsInitialized",[i,t]),simpayApp.isStripeCheckoutForm(t)&&simpayApp.setupStripeCheckout(i,t),simpayApp.spFormData[e]=t,a.trigger("simpayBindCoreFormEventsAndTriggers",[i,t])},setupStripeCheckout:function(t,a){var i=t.find("."+a.submitBtnClass),e=null;i.length&&(e=StripeCheckout.configure({key:a.stripeParams.key,token:function(i,e){!function(i,e){var n=t.find("."+a.submitBtnClass);s("<input>").attr({type:"hidden",name:"simpay_stripe_token",value:i.id}).appendTo(t),s("<input>").attr({type:"hidden",name:"simpay_stripe_email",value:i.email}).appendTo(t),e&&simpayApp.handleStripeAddressArgs(t,e);n.prop("disabled",!0).find("span").text(a.loadingText),t.off("submit"),t.submit()}(i,e)},opened:function(){},closed:function(){}})),t.on("submit",function(i){i.preventDefault(),function(){if(a.isValid=!0,t.trigger("simpayBeforeStripePayment",[t,a]),a.isValid){simpayApp.setCoreFinalAmount(t,a),a.stripeParams.amount=spShared.convertToCents(a.finalAmount),t.find(".simpay-amount").val(a.stripeParams.amount);var i=a.stripeParams;delete i.country,e.open(i)}}()})},handleStripeAddressArgs:function(t,a){a.shipping_name&&t.find('[name="simpay_shipping_customer_name"]').val(a.shipping_name),a.billing_name&&t.find('[name="simpay_billing_customer_name"]').val(a.billing_name);s.each(["line1","city","state","postal_code","country"],function(i,e){var n=e;"postal_code"===e&&(n="zip"),a["shipping_address_"+n]&&t.find('[name="simpay_shipping_address_'+e+'"]').val(a["shipping_address_"+n]),a["billing_address_"+n]&&t.find('[name="simpay_billing_address_'+e+'"]').val(a["billing_address_"+n])})},setCoreFinalAmount:function(i,e){e.finalAmount=e.amount,a.trigger("simpayFinalizeCoreAmount",[i,e])}},s(document).ready(function(i){simpayApp.init()})}(jQuery);